<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">  

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script type="text/javascript" src="lib/protovis-3.2/protovis-d3.2.js"></script>
<script type="text/javascript" charset="utf-8" src="utils.js"></script>
<script type="text/javascript" charset="utf-8" src="lib/lodash.underscore.min.js"></script>
<script type="text/javascript" charset="utf-8" src="radars/radarData.js"></script>
<script src="lib/d3.min.js"></script>

<style type="text/css" media="screen">
  
#fig {
  height: 1000px;
  width: 1400px;
}
.tech {padding-right: 10px; display:inline-block}
  .Quad{font-size: 1.5em;}
  .smltxt{width:50px}
  .cattitle{padding-right: 10px; display:inline-block}
  textarea#jsondata {
    width: 600px;
    height: 300px;
}
  #EditForm {
    width: 300px;
    height: 125px;
    background-color: #FFA961;
    position: absolute;
    left: 10px;
    top: 0px;
    padding: 20px;
    border-radius: 10px;
    border-color: black;
    display:none;
}
  .inpform div {margin-bottom: 15px;}
  .inpform .ra, .inpform .th {
    display: inline-block;
    padding-right: 10px;
}
</style>
<script type="text/javascript" src="radar.js" charset="utf-8"></script>


</head>

<body onload="init(h,w);form()">
<h1 id="title" style="text-align: center;"></h1>
<div id="radar"></div>

  <div id="EditData">

  </div>

  <div id="EditForm">

  </div>

  <div>
    <textarea id="jsondata"></textarea>
    <input type="button" value="Load" onclick = "reload()">
  </div>
</body>

  <script type="text/javascript" charset="utf-8">
    function reload(){
      radar_data= JSON.parse( document.getElementById("jsondata").value);
      init(h,w);
      form();
    }
    id = 0;
    d3.select("#title").on("click", titlechange);

    function titlechange()
    {
      var n = prompt('What new', document.title);
      if(n!=undefined){
        d3.select("#title").html(n);
        document.title = n;
      }

    }

    function form()
    {
    d3.select("#EditData").selectAll("div").remove();
    Categories = d3.select("#EditData").append("form").selectAll("div").data(radar_data).enter().append("div").attr("class","Quad");
    Categories.append("div").attr("class","cattitle").text(function(d){return d.quadrant});
    Categories.append("input").attr("type","button").attr("value", "x").on("click",function(d,i){DeleteAll(d,i)});
    items = Categories.append("div").selectAll("div")
      .data(function(d){return d.items}).enter()
      .append("div").attr("class","tech");
    items.append("input").attr("type","text")
      .attr("id",function(d){id++;d.id = id;return "txt"+id})
      .attr("name",function(d){return d.name})
      .attr("value", function(d){return d.name})
      .attr("onChange",function(d){return "updatetxt(this, function(x, val){return x.name = val})"} );
    items.append("input").attr("type","text").attr("class","smltxt")
      .attr("value", function(d){return d.pc.r})
      .attr("onChange",function(d){return "updatetxt(this, function(x, val){return x.pc.r = val})"} );
    items.append("input").attr("type","text").attr("class","smltxt")
      .attr("value", function(d){return d.pc.t})
      .attr("onChange",function(d){return "updatetxt(this, function(x, val){return x.pc.t = val})"} );

    items.append("input").attr("type","button").attr("value", "x").on("click",function(d,i,j){DeleteItem(d.id,i,j)});
    Categories.append("input").attr("type","button").attr("value", "Add").on("click",function(d,i){AddItem(d,i)});
    d3.select("#jsondata").text(JSON.stringify(radar_data));
    }


function setformpos(d){
  popp = d3.select("#EditForm");
  popp.style("left",event.pageX-20);
  popp.style("top",event.pageY+10);

}
function update(d)
{
  setformpos(d);
  setformdata(d);
}
function setformdata(d)
{
  popp = d3.select("#EditForm");
  popp.style("display","block");
  popp.html("");
  popp.append("input").attr("type","button").attr("value", "X").attr("style","float:right;margin-right:0px").on("click",function(d,i){popp.style("display","none");});
  pf = popp.append("div").attr("class","inpform")
    .selectAll("div").data([d]).enter();
//  pf.append("div").text(function(z){return "Name"});
  na = pf.append("div");
  na.append("input").attr("type","text").attr("value", function(z){return z.name}).attr("style","width:220px")
    .attr("onChange",function(d){return "updatetxt(this, function(x, val){return x.name = val})"} );
  rad = pf.append("div").attr("class","ra").text(function(z){return "Radius"});
  radt = rad.append("input").attr("type","text").attr("value", function(z){return z.pc.r}).attr("style","width:30px")
    .attr("onChange",function(d){return "updatetxt(this, function(x, val){return x.pc.r = val})"} );
  rad.append("input").attr("type","button").attr("value", "+")
    .on("click",function(r){r.pc.r = parseInt(r.pc.r) + 10; radt.attr("value",r.pc.r); init(h,w);form();});
  rad.append("input").attr("type","button").attr("value", "-")
    .on("click",function(r){r.pc.r = parseInt(r.pc.r) - 10; radt.attr("value",r.pc.r);init(h,w); form();});
  th = pf.append("div").attr("class","th").text(function(z){return "Angle"});
  tht = th.append("input").attr("type","text").attr("value", function(z){return z.pc.t}).attr("style","width:30px")
    .attr("onChange",function(d){return "updatetxt(this, function(x, val){return x.pc.t = val})"} );
  th.append("input").attr("type","button").attr("value", "+")
    .on("click",function(r){r.pc.t = parseInt(r.pc.t) + 3; tht.attr("value",r.pc.t); init(h,w); form();});
  th.append("input").attr("type","button").attr("value", "-")
    .on("click",function(r){r.pc.t = parseInt(r.pc.t) - 3; tht.attr("value",r.pc.t); init(h,w); form();});

}
    function AddItem(d,i){
      console.log(i);
      if(i==0) t = 135;
      if(i==1) t = 45;
      if(i==2) t = 225;
      if(i==3) t = 315;
      newobj = {"name":"New", "pc":{"r":350,"t":t},"movement":"c"};

      d.items.push(newobj);
      init(h,w);
      form();
      setformdata(newobj);
    }


    function DeleteAll(d,i)
    {
      d.items=[];
      init(h,w);
      form();
    }
    function DeleteItem(d,i,j)
    {
      radar_data[j].items.splice(i,1);
      init(h,w);
      form();
    }


    function updatetxt(obj,fpr)
    {
      fpr(d3.select(obj).data()[0],obj.value);
      init(h,w);
      form();
    }

  </script>
</html>










